---
title: "How to deploy VuePress on Google Firebase using Cloud Build"
date: 2019-03-01
image: ./gcp_datacenter_MayesCountyServerRow.jpg
tags:
  - VuePress
  - GCP
  - Firebase
  - CloudBuild
last_modified_at: 2019-03-05T06:45:01-05:00
---

This post outline the different steps required to deploy **VuePress** on **Google Firebase** using **Google Cloud Build** to automate the process.

## The VuePress site

The first step, if it's not done already, is to create a VuePress site. For the complete instructions see the "Getting Started" guide on https://vuepress.vuejs.org/guide/getting-started.html. Basically, inside a new folder :
`mkdir myVuePress cd myVuePress npm install -g vuepress mkdir docs echo '# Hello VuePress' > docs/README.md vuepress build docs`

The last command will create the **_docs/.vuepress/dist_** folder. This folder contains the static web site that has been generated by the VuePress build and this is the one that we want to deploy on Firebase. In the next step, we will add this folder path in on of the Firebase config file.

## Firebase configuration files

- Create the **_firebase.json_** config file :

  ```json
  {
    "hosting": {
      "public": "./docs/.vuepress/dist",
      "ignore": []
    }
  }
  ```

- And also the **_.firebaserc_** where you will need to specify your Firebase project ID :
  ```json
  {
    "projects": {
      "default": "<YOUR_FIREBASE_ID>"
    }
  }
  ```

* We can now test our configuration by deploying to Firebase. In order to do that, install the firebase-tools :

        npm install -g firebase-tools

* Once it's installed, run the following command to launch the deployment on Firebase :

        firebase deploy

## Google Cloud build setup

### Configuration file

Once you got a successful deployment on Firebase, you can start working on automating the build and deploy process using Google Cloud Build. To achieve this, it needs a **_cloudbuild.yaml_** config file detailing the steps we need to execute. Inside your VuePress folder, add the **_cloudbuild.yaml_** file with the following content:

```yaml
steps:
- name: 'gcr.io/vuepress-e0b13/vuepress'
args: [ 'build', 'docs' ]
- name: 'gcr.io/vuepress-e0b13/firebase'
args: [ 'deploy', '--token', '${_FIREBASETOKEN}']
images:
- 'gcr.io/vuepress-e0b13/firebase'
- 'gcr.io/vuepress-e0b13/vuepress'
```

We are defining two steps. They are both executing a containerized image of VuePress and Firebase tools. We will see more on this later.

### Code repository

Google Cloud Build will automatically launch a build when you push a new commit on your Git repository. Put the VuePress source files on one of these three :

- Cloud Source Repository
- Bitbucket
- GitHub

### Build tools

We now need to make available to Google Cloud Build the two tools that we will need to build the VuePress site and deploy it to Firebase. These tools will be placed in their respective Docker containers and **they are only needed for the build process**. The VuePress build also **needs Node.js 8.x** or newer. Make sure you specify **"node:carbon" (or newer)** inside your Dockerfile or the VuePress build will not work. Google's documentation is still referring to "node:boron" which is Node.js 6.

- Create a new folder and name it _"DockerVuePress"_. Inside it, put these two configuration files:

  - **_cloudbuild.yaml_**

    ```yaml
    steps:
      - name: "gcr.io/cloud-builders/docker"
    args: ["build", "-t", "gcr.io/[PROJECT_ID]/vuepress", "."]
    images:
      - "gcr.io/[PROJECT_ID]/vuepress"
    ```

    You need to replace _[PROJECT_ID]_ with your Google Cloud project ID.

  - **_Dockerfile_**

    ```console
    # use Node 8 / Carbon
    FROM node:carbon
    # install Firebase CLI
    RUN npm install -g vuepress

    ENTRYPOINT ["/usr/local/bin/vuepress"]
    ```

  Now run the following command to build the VuePress Docker container:

        gcloud builds submit --config=cloudbuild.yaml .

  In order to run this command, make sure you have Google Cloud SDK installed. You can get it here: [https://cloud.google.com/sdk/](https://cloud.google.com/sdk/)

- Create a new folder and name it _"DockerFirebase"_. Like what we did for VuePress, put these two files inside it:

  - **_cloudbuild.yaml_**

    ```yaml
    steps:
      - name: "gcr.io/cloud-builders/docker"
    args: ["build", "-t", "gcr.io/[PROJECT_ID]/firebase", "."]
    images:
      - "gcr.io/[PROJECT_ID]/firebase"
    ```

    You need to replace _[PROJECT_ID]_ with your Google Cloud project ID.

  - **_Dockerfile_**

    ```console
    # use Node 8 / Carbon
    FROM node:carbon
    # install Firebase CLI
    RUN npm install -g firebase-tools

    ENTRYPOINT ["/usr/local/bin/firebase"]
    ```

  Now run the same gcloud command :

        gcloud builds submit --config=cloudbuild.yaml .

### Google Cloud Build Trigger

- The final step is to configure a new trigger in Google Cloud Build. The configuration looks like this :


    ![Google Cloud Build trigger configuration]({{ site.baseurl }}./google-cloud-build-trigger.PNG)


    Make sure you add the **"_FIREBASETOKEN" variable**. This variable contains your Firebase token.

## Final words

This is it, now when you will push a commit in your branch (master in my example) it will automatically redeploy your VuePress site.
For more information on the various parts of this how-to please visit these links :

- Google Cloud Build: [https://cloud.google.com/cloud-build/docs/configuring-builds/build-test-deploy-artifacts](https://cloud.google.com/cloud-build/docs/configuring-builds/build-test-deploy-artifacts){:target="\_blank" rel="noopener"}
- VuePress getting started: [https://vuepress.vuejs.org/guide/getting-started.html#inside-an-existing-project](https://vuepress.vuejs.org/guide/getting-started.html#inside-an-existing-project){:target="\_blank" rel="noopener"}
- VuePress deploying: [https://vuepress.vuejs.org/guide/deploy.html#google-firebase](https://vuepress.vuejs.org/guide/deploy.html#google-firebase){:target="\_blank" rel="noopener"}
- Google Cloud SDF : [https://cloud.google.com/sdk/](https://cloud.google.com/sdk/){:target="\_blank" rel="noopener"}
- Special mention to Ertan Dogrultan post, thanks to him I have been able to upgrade to Node 8 quickly: [https://medium.com/google-cloud/migrating-firebase-cloud-functions-to-node-8-aebdb0d3d9a9](https://medium.com/google-cloud/migrating-firebase-cloud-functions-to-node-8-aebdb0d3d9a9){:target="\_blank" rel="noopener"}
